<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delete Button Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        button { margin: 5px; padding: 8px 15px; }
        .log { background: #f5f5f5; padding: 10px; font-family: monospace; white-space: pre-wrap; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üîß Delete Button Isolated Test</h1>
    
    <div class="test-section">
        <h3>Test Environment</h3>
        <button onclick="addTestGame()">Add Test Game</button>
        <button onclick="listGames()">List All Games</button>
        <button onclick="testStoreDelete()">Test Store.deleteGame Directly</button>
        <button onclick="testUIDelete()">Test UI Delete Button</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <div class="test-section">
        <h3>Game List</h3>
        <div id="gamesList"></div>
    </div>

    <div class="test-section">
        <h3>Simulate Game Form</h3>
        <div id="gameFormSection" class="hidden">
            <form id="gameForm">
                <input type="text" name="date" value="2025-08-06">
                <input type="text" name="time" value="15:00">
                <input type="text" name="home" value="Test Home">
                <input type="text" name="away" value="Test Away">
                <button type="button" id="deleteGameBtn" class="btn secondary">Delete Game</button>
            </form>
        </div>
    </div>

    <div class="test-section">
        <h3>Test Log</h3>
        <div id="log" class="log"></div>
    </div>

    <script src="js/store.js"></script>
    <script>
        let editingGameId = null;
        let testGameId = null;

        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        function addTestGame() {
            const testGame = {
                date: '2025-08-06',
                time: '15:00',
                league: 'Test League',
                home: 'Test Home',
                away: 'Test Away',
                pay: 30
            };
            
            Store.addGame(testGame);
            const state = Store.getState();
            testGameId = state.games[state.games.length - 1].id;
            
            log(`‚úÖ Added test game with ID: ${testGameId}`);
            listGames();
        }

        function listGames() {
            const state = Store.getState();
            const gamesList = document.getElementById('gamesList');
            
            if (state.games.length === 0) {
                gamesList.innerHTML = '<p>No games found</p>';
                log('üìä No games in store');
                return;
            }

            let html = '<ul>';
            state.games.forEach(game => {
                html += `<li>ID: ${game.id} - ${game.date} ${game.time} - ${game.home} vs ${game.away} 
                         <button onclick="simulateEdit(${game.id})">Edit</button></li>`;
            });
            html += '</ul>';
            gamesList.innerHTML = html;
            
            log(`üìä Found ${state.games.length} games in store`);
        }

        function testStoreDelete() {
            if (!testGameId) {
                log('‚ùå No test game ID. Add a test game first.');
                return;
            }

            const beforeState = Store.getState();
            const beforeCount = beforeState.games.length;
            
            log(`üß™ Testing Store.deleteGame(${testGameId})`);
            log(`üìä Games before deletion: ${beforeCount}`);
            
            Store.deleteGame(testGameId);
            
            const afterState = Store.getState();
            const afterCount = afterState.games.length;
            
            log(`üìä Games after deletion: ${afterCount}`);
            
            if (afterCount === beforeCount - 1) {
                log('‚úÖ Store.deleteGame() works correctly');
            } else {
                log('‚ùå Store.deleteGame() failed');
            }
            
            listGames();
        }

        function simulateEdit(gameId) {
            editingGameId = gameId;
            log(`üéÆ Simulating edit for game ID: ${gameId}`);
            
            const gameFormSection = document.getElementById('gameFormSection');
            gameFormSection.classList.remove('hidden');
            
            // Set up delete button click handler (simulating openGameForm)
            const deleteGameBtn = document.getElementById('deleteGameBtn');
            
            // Remove existing handlers
            deleteGameBtn.onclick = null;
            
            deleteGameBtn.onclick = (event) => {
                event.preventDefault();
                log(`üóëÔ∏è Delete button clicked for game ID: ${editingGameId}`);
                
                if (!editingGameId) {
                    log('‚ùå No editingGameId set');
                    return;
                }
                
                if (confirm("Delete this game?")) {
                    log('‚úÖ User confirmed deletion');
                    
                    const beforeState = Store.getState();
                    log(`üìä Games before: ${beforeState.games.length}`);
                    
                    Store.deleteGame(editingGameId);
                    
                    const afterState = Store.getState();
                    log(`üìä Games after: ${afterState.games.length}`);
                    
                    editingGameId = null;
                    gameFormSection.classList.add('hidden');
                    listGames();
                    
                    log('‚úÖ Delete operation completed');
                } else {
                    log('‚ùå User cancelled deletion');
                }
            };
            
            log('üîß Delete button handler attached');
        }

        function testUIDelete() {
            if (!testGameId) {
                log('‚ùå No test game. Add one first and click Edit on it.');
                return;
            }
            
            log('üß™ Click Edit on a game first, then test the delete button');
        }

        // Initialize
        listGames();
    </script>
</body>
</html>
