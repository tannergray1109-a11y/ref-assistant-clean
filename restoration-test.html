<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎉 Restoration Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { margin: 5px; padding: 8px 15px; background: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a8b; }
        .log { background: #f5f5f5; padding: 10px; font-family: monospace; white-space: pre-wrap; margin: 10px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>🎉 App Restoration Test</h1>
    <p>Testing the restored clean app.js functionality</p>
    
    <div class="test-section">
        <h3>📊 Function Availability Test</h3>
        <button onclick="testFunctions()">Test Core Functions</button>
        <div id="functionTest"></div>
    </div>

    <div class="test-section">
        <h3>🎮 Game Management Test</h3>
        <button onclick="addTestGame()">Add Test Game</button>
        <button onclick="listGames()">List Games</button>
        <button onclick="testDelete()">Test Delete (Store Level)</button>
        <div id="gameTest"></div>
    </div>

    <div class="test-section">
        <h3>🔗 Main App Link</h3>
        <p>Once tests pass, try the main app:</p>
        <a href="https://ref-assistant-clean.web.app" target="_blank">
            <button>🚀 Open Main App</button>
        </a>
    </div>

    <div class="test-section">
        <h3>📝 Test Log</h3>
        <div id="log" class="log"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script src="js/store.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/calendar.js"></script>
    <script src="calendar-ui.js"></script>
    <script src="js/app.js"></script>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        function testFunctions() {
            const testDiv = document.getElementById('functionTest');
            testDiv.innerHTML = '';
            
            const tests = [
                {name: 'Store', test: () => typeof Store !== 'undefined'},
                {name: 'Store.getState', test: () => typeof Store?.getState === 'function'},
                {name: 'Store.addGame', test: () => typeof Store?.addGame === 'function'},
                {name: 'Store.deleteGame', test: () => typeof Store?.deleteGame === 'function'},
                {name: 'openGameForm', test: () => typeof openGameForm === 'function'},
                {name: 'renderGamesTable', test: () => typeof renderGamesTable === 'function'},
                {name: 'Calendar', test: () => typeof Calendar !== 'undefined'},
                {name: 'Calendar.isConnected', test: () => typeof Calendar?.isConnected === 'function'}
            ];

            let passed = 0;
            tests.forEach(test => {
                try {
                    if (test.test()) {
                        testDiv.innerHTML += `<div class="success">✅ ${test.name}</div>`;
                        passed++;
                    } else {
                        testDiv.innerHTML += `<div class="error">❌ ${test.name}</div>`;
                    }
                } catch (e) {
                    testDiv.innerHTML += `<div class="error">❌ ${test.name} - Error: ${e.message}</div>`;
                }
            });

            testDiv.innerHTML += `<div class="info"><strong>Result: ${passed}/${tests.length} functions available</strong></div>`;
            log(`Function test completed: ${passed}/${tests.length} passed`);
        }

        function addTestGame() {
            try {
                const testGame = {
                    date: '2025-08-06',
                    time: '19:00',
                    league: 'Restoration Test',
                    home: 'Clean Team',
                    away: 'Restored Team',
                    pay: 50
                };
                
                Store.addGame(testGame);
                const state = Store.getState();
                const addedGame = state.games[state.games.length - 1];
                
                document.getElementById('gameTest').innerHTML += `<div class="success">✅ Game added with ID: ${addedGame.id}</div>`;
                log(`Game added successfully with ID: ${addedGame.id}`);
                listGames();
            } catch (e) {
                document.getElementById('gameTest').innerHTML += `<div class="error">❌ Error adding game: ${e.message}</div>`;
                log(`Error adding game: ${e.message}`);
            }
        }

        function listGames() {
            try {
                const state = Store.getState();
                const gameTest = document.getElementById('gameTest');
                
                if (state.games.length === 0) {
                    gameTest.innerHTML += `<div class="info">📊 No games in store</div>`;
                } else {
                    gameTest.innerHTML += `<div class="info">📊 Found ${state.games.length} games:</div>`;
                    state.games.slice(-3).forEach(game => {
                        gameTest.innerHTML += `<div class="info">  • ID ${game.id}: ${game.date} - ${game.home} vs ${game.away}</div>`;
                    });
                }
                log(`Listed games: ${state.games.length} total`);
            } catch (e) {
                document.getElementById('gameTest').innerHTML += `<div class="error">❌ Error listing games: ${e.message}</div>`;
                log(`Error listing games: ${e.message}`);
            }
        }

        function testDelete() {
            try {
                const state = Store.getState();
                if (state.games.length === 0) {
                    document.getElementById('gameTest').innerHTML += `<div class="error">❌ No games to delete. Add a game first.</div>`;
                    return;
                }

                const gameToDelete = state.games[state.games.length - 1];
                const beforeCount = state.games.length;
                
                Store.deleteGame(gameToDelete.id);
                
                const afterState = Store.getState();
                const afterCount = afterState.games.length;
                
                if (afterCount === beforeCount - 1) {
                    document.getElementById('gameTest').innerHTML += `<div class="success">✅ Delete function works! ${beforeCount} → ${afterCount} games</div>`;
                    log(`Delete test passed: ${beforeCount} → ${afterCount} games`);
                } else {
                    document.getElementById('gameTest').innerHTML += `<div class="error">❌ Delete failed: ${beforeCount} → ${afterCount} games</div>`;
                    log(`Delete test failed: ${beforeCount} → ${afterCount} games`);
                }
                
                listGames();
            } catch (e) {
                document.getElementById('gameTest').innerHTML += `<div class="error">❌ Error testing delete: ${e.message}</div>`;
                log(`Error testing delete: ${e.message}`);
            }
        }

        // Auto-run function test
        setTimeout(testFunctions, 1000);
    </script>
</body>
</html>
