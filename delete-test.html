<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delete Game Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        button { margin: 5px; padding: 8px 15px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Delete Game Test</h1>
    
    <div class="test-section">
        <h3>Current Games</h3>
        <div id="currentGames"></div>
        <button onclick="refreshGamesList()">Refresh Games List</button>
    </div>
    
    <div class="test-section">
        <h3>Add Test Game</h3>
        <button onclick="addTestGame()">Add Test Game</button>
    </div>
    
    <div class="test-section">
        <h3>Delete Game Test</h3>
        <input type="number" id="deleteId" placeholder="Game ID to delete">
        <button onclick="testDeleteGame()">Delete Game</button>
    </div>
    
    <div class="test-section">
        <h3>Test Log</h3>
        <div id="testLog"></div>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <script src="js/store.js"></script>
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
            console.log(message);
        }

        function refreshGamesList() {
            const currentGames = document.getElementById('currentGames');
            const state = Store.getState();
            
            if (state.games.length === 0) {
                currentGames.innerHTML = '<p>No games found</p>';
                log('No games in store', 'info');
            } else {
                let html = '<ul>';
                state.games.forEach(game => {
                    html += `<li>ID: ${game.id} - ${game.date} ${game.time} - ${game.home} vs ${game.away}</li>`;
                });
                html += '</ul>';
                currentGames.innerHTML = html;
                log(`Found ${state.games.length} games`, 'success');
            }
        }

        function addTestGame() {
            const testGame = {
                date: '2025-01-28',
                time: '19:00',
                league: 'Test League',
                home: 'Test Home',
                away: 'Test Away',
                pay: 50
            };
            
            Store.addGame(testGame);
            log('Added test game', 'success');
            refreshGamesList();
        }

        function testDeleteGame() {
            const deleteId = parseInt(document.getElementById('deleteId').value);
            
            if (!deleteId) {
                log('Please enter a valid game ID', 'error');
                return;
            }

            const state = Store.getState();
            const gameBeforeDelete = state.games.find(g => g.id === deleteId);
            
            if (!gameBeforeDelete) {
                log(`Game with ID ${deleteId} not found`, 'error');
                return;
            }

            log(`Attempting to delete game: ${gameBeforeDelete.date} - ${gameBeforeDelete.home} vs ${gameBeforeDelete.away}`, 'info');
            
            // Test the delete function
            Store.deleteGame(deleteId);
            
            // Check if it was actually deleted
            const stateAfterDelete = Store.getState();
            const gameAfterDelete = stateAfterDelete.games.find(g => g.id === deleteId);
            
            if (gameAfterDelete) {
                log(`ERROR: Game with ID ${deleteId} still exists after deletion!`, 'error');
            } else {
                log(`SUCCESS: Game with ID ${deleteId} was deleted`, 'success');
            }
            
            refreshGamesList();
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
        }

        // Initialize
        refreshGamesList();
    </script>
</body>
</html>
